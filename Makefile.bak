# Makefile for ML Pipeline (macOS-friendly with python3)

.PHONY: data features train evaluate serve test mlflow docker-build docker-run install

data:
	python3 src/data/make_dataset.py

features:
	python3 src/features/build_features.py

train:
	python3 src/models/train.py

evaluate:
	python3 src/models/evaluate.py

serve:
	python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload --app-dir src


test:
	pytest tests

mlflow:
	mlflow ui

docker-build:
	docker build -t ml-pipeline .

docker-run:
	docker run -p 5000:5000 ml-pipeline

install:
	python3 -m pip install -r requirements.txt



frontend:
	python3 -m http.server 3000 --directory web

smoke:
	python3 - <<'PY'
import requests
b="http://127.0.0.1:8000"
assert requests.get(f"{b}/health").json()["status"]=="ok"
pl={"sepal_length":5.1,"sepal_width":3.5,"petal_length":1.4,"petal_width":0.2}
print(requests.post(f"{b}/predict", json=pl).json())
PY
